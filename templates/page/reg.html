{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>QR</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
     <link rel="stylesheet" href="{% static 'css/add1.css' %}">
</head>
<body >
<div id="app">
 <div class="page__wrapper">
     {% include 'page/_left_side.menu.html' %}
    <div class="page__right">
        <div class="auth-form">
            <h1>REGISTRATION</h1>
            <input type="email" required v-model="email" placeholder="Email">
            <input type="text" required v-model="nickname" placeholder="Nickname">
            <input type="password" required v-model="password1" placeholder="Password">
            <input type="password" required v-model="password2" placeholder="Repeat password">
            <button @click="sendSignUp">REGISTER</button>
            <div style="margin-bottom: 20px;color: red; max-width: 293px;" v-html="reg_error"></div>
            <p class="auth-form__grey">Have account? <a href="{% url 'login' %}">Login</a></p>

        </div>

    </div>
</div>
   <div class="page__mobile">
    <div class="page__mobile-logo">
        <img src="{% static 'images/logo-b.png' %}" alt="">
    </div>
    <div class="page__mobile-text">
        <h1>We work only on the PC version of the site</h1>
        <p>Our analytical systems and metrics work only on pc users</p>
    </div>
</div>
</div>



 <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

<script>
     var app = new Vue({
            delimiters: ['[[', ']]'],
            el: '#app',
            data: {
                email:null,
                nickname:null,
                password1:null,
                password2:null,
                reg_error:'',
            },
            methods: {
                sendSignUp: function () {
                    console.log(this.name,this.email,this.password1,this.password2)
                    this.reg_error=''
                    let body = {
                        'email':this.email,
                        'nickname':this.nickname,
                        'password1':this.password1,
                        'password2':this.password2}

                    fetch('{% url 'register' %}', {
                        method: 'post',
                        body: JSON.stringify(body),
                        headers: { "X-CSRFToken": '{{  csrf_token }}' },
                        credentials: 'same-origin'
                    }).then(res=>res.json())
                        .then(res => {

                            console.log(res)
                            if(res['status']==='success'){
                                window.location.href='{% url 'index' %}'
                            }else{
                                if(res['errors']['email']){
                                    this.reg_error = this.reg_error + 'Email: '+ res['errors']['email'] + '<br>'
                                }
                                if(res['errors']['password2']){
                                    this.reg_error = this.reg_error + 'Password: '+ res['errors']['password2']
                                }

                            }
                        })
                },

            }
        })
</script>



</body>
</html>


